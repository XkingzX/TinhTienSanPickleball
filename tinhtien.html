<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Tính Tiền Pickleball</title>
<style>
    body { font-family: Arial; padding: 20px; max-width: 500px; margin: auto }
    select, input { width: 100%; padding: 10px; margin: 8px 0 }
    button { padding: 10px; width: 100%; font-size: 16px; cursor: pointer; margin-top:5px }
    #result { margin-top: 20px; font-size: 20px; font-weight: bold; }

    .history-box { margin-top:30px; border-top:1px solid #ccc; padding-top:20px }
    .history-item { padding:10px; border:1px solid #ddd; border-radius:6px; margin-bottom:8px }
    .pagination { display:flex; justify-content:center; gap:10px; margin-top:10px }
    .pagination button { width:80px }
</style>
</head>

<body>
<h2>Tính Tiền Sân Pickleball</h2>

<label>Tên khách hàng</label>
<input id="name" type="text" placeholder="Nhập tên">

<label>Loại khách</label>
<select id="customerType">
    <option value="codinh">Khách cố định</option>
    <option value="le">Khách lẻ</option>
</select>

<label>Ngày</label>
<select id="dayType">
    <option value="thu2-6">Thứ 2 - Thứ 6</option>
    <option value="thu7-cn">Thứ 7 - CN & lễ</option>
</select>

<label>Khung giờ</label>
<select id="timeSlot">
    <option value="slot1">5:00 - 11:30</option>
    <option value="slot2">13:30 - 17:00</option>
    <option value="slot3">17:00 - 19:00</option>
    <option value="slot4">19:00 - 22:00</option>
</select>

<label>Giờ chơi</label>
<div style="display:flex; gap:10px;">
    <select id="hoursPlayed">
        <script>
            for (let i = 0; i <= 12; i++) {
                document.write(`<option value="${i}">${i} giờ</option>`);
            }
        </script>
    </select>

    <input 
        id="minutesPlayed" 
        type="number" 
        min="0" 
        max="59" 
        placeholder="phút (0 - 59)" 
        style="width:100px; padding:10px;"
    >
</div>

<button onclick="tinhTien()">Tính tiền</button>
<button onclick="resetForm()">Reset thông tin</button>

<div id="result"></div>

<!-- ---------- LỊCH SỬ ---------- -->
<div class="history-box">
    <h3>Lịch sử gần đây</h3>
    <div id="historyList"></div>

    <div class="pagination">
        <button onclick="changePage(-1)">◀ Trang trước</button>
        <button onclick="changePage(1)">Trang sau ▶</button>
    </div>
    <div style="text-align:center; margin-top:10px;">
        <span id="pageInfo"></span>
    </div>
</div>

<script>
/* ========= BẢNG GIÁ ========= */
function getPrice(type, day, slot) {
    const priceTable = {
        codinh: {
            'thu2-6': [40000, 60000, 140000, 90000],
            'thu7-cn': [60000, 90000, 140000, 60000]
        },
        le: {
            'thu2-6': [50000, 70000, 160000, 100000],
            'thu7-cn': [70000, 100000, 160000, 70000]
        }
    };
    return priceTable[type][day][slot];
}

/* ========= TÍNH TIỀN ========= */
function tinhTien() {
    let name = document.getElementById('name').value.trim();
    if (name === "") {
        alert("Nhập tên khách hàng");
        return;
    }

    let type = document.getElementById('customerType').value;
    let day = document.getElementById('dayType').value;
    let slot = document.getElementById('timeSlot').selectedIndex;

    let hours = parseInt(document.getElementById('hoursPlayed').value);
    let minutes = Math.min(59, Math.max(0, parseInt(document.getElementById('minutesPlayed').value) || 0));

    let totalMinutes = hours * 60 + minutes;
    let pricePerHour = getPrice(type, day, slot);

    let totalMoney = Math.ceil((pricePerHour / 60) * totalMinutes);

    document.getElementById('result').innerHTML =
        `Tổng tiền: <span style="color:red">${totalMoney.toLocaleString()} đ</span>`;

    saveHistory({
        name,
        hours,
        minutes,
        total: totalMoney,
        timeSlot: document.getElementById("timeSlot").value,
        timestamp: new Date().toLocaleString()
    });
}

/* ========= RESET FORM ========= */
function resetForm() {
    document.getElementById("name").value = "";
    document.getElementById("hoursPlayed").value = 0;
    document.getElementById("minutesPlayed").value = "";
    document.getElementById("result").innerHTML = "";
}

/* ========= LỊCH SỬ ========= */
let page = 1;

function saveHistory(entry) {
    let history = JSON.parse(localStorage.getItem("pickleHistory") || "[]");

    history.unshift(entry); // thêm đầu danh sách

    if (history.length > 20) history = history.slice(0, 20); // chỉ giữ 20

    localStorage.setItem("pickleHistory", JSON.stringify(history));

    renderHistory();
}

function renderHistory() {
    let history = JSON.parse(localStorage.getItem("pickleHistory") || "[]");

    let start = (page - 1) * 10;
    let end = start + 10;

    let items = history.slice(start, end);

    let html = items.map(h => `
        <div class="history-item">
            <b>${h.name}</b> — ${h.hours} giờ ${h.minutes} phút<br>
            Khung: ${h.timeSlot}<br>
            Tiền: <span style="color:red">${h.total.toLocaleString()} đ</span><br>
            <small>${h.timestamp}</small>
        </div>
    `).join("");

    document.getElementById("historyList").innerHTML = html || "Không có lịch sử";

    document.getElementById("pageInfo").innerText =
        `Trang ${page} / ${Math.ceil(history.length / 10) || 1}`;
}

function changePage(dir) {
    let history = JSON.parse(localStorage.getItem("pickleHistory") || "[]");
    let maxPage = Math.ceil(history.length / 10);

    page += dir;
    if (page < 1) page = 1;
    if (page > maxPage) page = maxPage;

    renderHistory();
}

/* Khi mở trang thì load lịch sử */
renderHistory();

</script>

</body>
</html>
